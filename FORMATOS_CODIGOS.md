# Formatos de C√≥digos del Sistema

## Resumen Visual

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    TIPOS DE C√ìDIGOS                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  üìã SOCIOS TITULARES                                           ‚îÇ
‚îÇ  ‚îú‚îÄ Formato:      #### (4 d√≠gitos num√©ricos)                   ‚îÇ
‚îÇ  ‚îú‚îÄ Ejemplos:     0001, 0234, 1456                            ‚îÇ
‚îÇ  ‚îú‚îÄ Fuente:       API Externa                                  ‚îÇ
‚îÇ  ‚îú‚îÄ Permanencia:  Permanente                                   ‚îÇ
‚îÇ  ‚îî‚îÄ Uso:          Club + Eventos                               ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  üë®‚Äçüë©‚Äçüëß‚Äçüë¶ FAMILIARES DE SOCIOS                                        ‚îÇ
‚îÇ  ‚îú‚îÄ Formato:      ####-XXX (4 d√≠gitos + guion + letras)       ‚îÇ
‚îÇ  ‚îú‚îÄ Ejemplos:     0001-A, 0234-B, 1456-FAM                    ‚îÇ
‚îÇ  ‚îú‚îÄ Fuente:       API Externa                                  ‚îÇ
‚îÇ  ‚îú‚îÄ Permanencia:  Permanente (vinculado a socio)              ‚îÇ
‚îÇ  ‚îú‚îÄ Vinculaci√≥n:  Primeros 4 d√≠gitos = c√≥digo socio titular   ‚îÇ
‚îÇ  ‚îî‚îÄ Uso:          Club + Eventos                               ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  üé´ INVITADOS TEMPORALES (No Eventos)                          ‚îÇ
‚îÇ  ‚îú‚îÄ Formato:      #### (4 d√≠gitos num√©ricos)                   ‚îÇ
‚îÇ  ‚îú‚îÄ Ejemplos:     0500, 0789, 0999                            ‚îÇ
‚îÇ  ‚îú‚îÄ Fuente:       Registro Externo (NO en API)                ‚îÇ
‚îÇ  ‚îú‚îÄ Permanencia:  NO permanente - Temporal                     ‚îÇ
‚îÇ  ‚îú‚îÄ Prop√≥sito:    Actividades/reservas espec√≠ficas con socios ‚îÇ
‚îÇ  ‚îî‚îÄ Uso:          Solo Entrada Club                           ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  üéâ INVITADOS DE EVENTO                                        ‚îÇ
‚îÇ  ‚îú‚îÄ Formato:      ####-INV# (c√≥digo socio + sufijo)           ‚îÇ
‚îÇ  ‚îú‚îÄ Ejemplos:     0001-INV1, 0001-INV2, 0234-INV1            ‚îÇ
‚îÇ  ‚îú‚îÄ Fuente:       Base de Datos Local                         ‚îÇ
‚îÇ  ‚îú‚îÄ Permanencia:  Por duraci√≥n del evento                      ‚îÇ
‚îÇ  ‚îú‚îÄ Vinculaci√≥n:  Primeros 4 d√≠gitos = c√≥digo socio anfitri√≥n ‚îÇ
‚îÇ  ‚îî‚îÄ Uso:          Solo eventos espec√≠ficos                     ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Detalles por Tipo

### 1. Socios Titulares

**Caracter√≠sticas:**
- Formato: `####` (exactamente 4 d√≠gitos num√©ricos)
- Rango v√°lido: `0001` a `9999`
- Son los due√±os principales de la membres√≠a

**Validaci√≥n Regex:**
```javascript
/^\d{4}$/
```

**Ejemplos V√°lidos:**
- ‚úÖ `0001`
- ‚úÖ `0234`
- ‚úÖ `1456`
- ‚úÖ `9999`

**Ejemplos Inv√°lidos:**
- ‚ùå `001` (menos de 4 d√≠gitos)
- ‚ùå `00001` (m√°s de 4 d√≠gitos)
- ‚ùå `0001-A` (tiene sufijo, es familiar)
- ‚ùå `S001` (tiene letras)

**Fuente de Datos:**
- API Externa: `GET /api/socios/{codigo}`
- Retorna: nombre, DNI, email, tel√©fono, √°rea

**Almacenamiento:**
- NO se almacenan localmente
- Solo referencias en `participantes_evento` cuando participan en eventos
- Historial en `entrada_club` cuando ingresan

---

### 2. Familiares de Socios

**Caracter√≠sticas:**
- Formato: `####-XXX` (4 d√≠gitos + guion + letras)
- Los primeros 4 d√≠gitos corresponden al socio titular
- El sufijo (letras despu√©s del guion) identifica al familiar
- Sufijos comunes: `A`, `B`, `C`, `FAM`, `ESP` (esposa), `HIJ1` (hijo 1)

**Validaci√≥n Regex:**
```javascript
/^\d{4}-[A-Z]+$/
```

**Ejemplos V√°lidos:**
- ‚úÖ `0001-A` (familiar A del socio 0001)
- ‚úÖ `0234-B` (familiar B del socio 0234)
- ‚úÖ `1456-FAM` (familiar del socio 1456)
- ‚úÖ `0001-ESP` (esposa del socio 0001)
- ‚úÖ `0001-HIJ1` (hijo 1 del socio 0001)

**Ejemplos Inv√°lidos:**
- ‚ùå `0001` (falta sufijo)
- ‚ùå `0001-1` (sufijo debe ser letras, no n√∫meros)
- ‚ùå `0001-a` (letras deben ser may√∫sculas)
- ‚ùå `001-A` (menos de 4 d√≠gitos)

**Fuente de Datos:**
- API Externa: `GET /api/socios/{codigo}` o `GET /api/socios/{codigo_socio}/familiares`
- Retorna: nombre, DNI, parentesco, c√≥digo del socio titular

**Relaci√≥n con Socio Titular:**
```javascript
const codigoFamiliar = "0001-A";
const codigoSocio = codigoFamiliar.substring(0, 4); // "0001"
```

**Almacenamiento:**
- Igual que socios: NO se almacenan localmente
- Referencias en `participantes_evento` y `entrada_club`

---

### 3. Invitados Temporales (No Eventos)

**Caracter√≠sticas:**
- Formato: `####` (mismo formato que socios, pero NO permanentes)
- **NO est√°n en la API externa**
- Son registros temporales creados externamente
- Usados para actividades puntuales o reservas con socios

**Diferencia con Socios:**
- Aunque el formato es id√©ntico (`####`), **NO est√°n en la API**
- Son temporales y no permanentes
- Se distinguen por el campo `tipo = 'invitado'` en `entrada_club`

**Validaci√≥n Regex:**
```javascript
/^\d{4}$/
```

**Ejemplos V√°lidos:**
- ‚úÖ `0500`
- ‚úÖ `0789`
- ‚úÖ `0999`

**Fuente de Datos:**
- **NO est√°n en API Externa**
- Registrados por sistemas externos (ej: sistema de reservas)
- Se almacenan **solo** cuando ingresan al club

**Almacenamiento:**
- Tabla `entrada_club` con `tipo = 'invitado'`
- NO en `participantes_evento`

**Ciclo de Vida:**
```
1. Sistema Externo registra invitado temporal (c√≥digo ####)
2. Invitado llega al club
3. Personal busca el c√≥digo
4. Sistema encuentra el c√≥digo en historial de entrada_club
5. Se registra nueva entrada
6. Despu√©s de la actividad, el c√≥digo queda inactivo
```

---

### 4. Invitados de Evento

**Caracter√≠sticas:**
- Formato: `####-INV#` (c√≥digo socio + sufijo INV + n√∫mero)
- Siempre vinculados a un socio anfitri√≥n
- Solo existen para eventos espec√≠ficos
- Se crean al registrar participantes en el m√≥dulo "Registro"

**Validaci√≥n Regex:**
```javascript
/^\d{4}-INV\d+$/
```

**Ejemplos V√°lidos:**
- ‚úÖ `0001-INV1` (invitado 1 del socio 0001)
- ‚úÖ `0001-INV2` (invitado 2 del socio 0001)
- ‚úÖ `0234-INV1` (invitado 1 del socio 0234)

**Ejemplos Inv√°lidos:**
- ‚ùå `0001-INV` (falta n√∫mero)
- ‚ùå `0001-inv1` (INV debe ser may√∫sculas)
- ‚ùå `001-INV1` (menos de 4 d√≠gitos)

**Fuente de Datos:**
- Base de Datos Local (tabla `participantes_evento`)
- Creados manualmente por personal del club

**Relaci√≥n con Socio Anfitri√≥n:**
```javascript
const codigoInvitado = "0001-INV1";
const codigoSocio = codigoInvitado.substring(0, 4); // "0001"
```

**Almacenamiento:**
- Tabla `participantes_evento`:
  - `codigo_participante`: `0001-INV1`
  - `codigo_socio`: `0001`
  - `tipo`: `'invitado'`
- Tabla `entrada_evento` (para control de asistencia)

---

## Tabla Comparativa

| Caracter√≠stica | Socio (####) | Familiar (####-XXX) | Invitado Temp (####) | Invitado Evento (####-INV#) |
|----------------|--------------|---------------------|---------------------|----------------------------|
| **Formato** | 4 d√≠gitos | 4 d√≠gitos-letras | 4 d√≠gitos | 4 d√≠gitos-INV-n√∫mero |
| **Ejemplo** | `0001` | `0001-A` | `0500` | `0001-INV1` |
| **En API** | ‚úÖ S√≠ | ‚úÖ S√≠ | ‚ùå No | ‚ùå No |
| **Permanente** | ‚úÖ S√≠ | ‚úÖ S√≠ | ‚ùå No | Solo durante evento |
| **Vinculado** | - | Socio titular | - | Socio anfitri√≥n |
| **Entrada Club** | ‚úÖ S√≠ | ‚úÖ S√≠ | ‚úÖ S√≠ | ‚ùå No (solo evento) |
| **Entrada Evento** | ‚úÖ S√≠ | ‚úÖ S√≠ | ‚ùå No | ‚úÖ S√≠ |
| **DB Local** | Referencias | Referencias | entrada_club | participantes_evento |

---

## Flujos de Uso

### Entrada al Club

**B√∫squeda:**
1. Usuario ingresa c√≥digo o nombre
2. Sistema busca en:
   - API Externa ‚Üí Socios (`####`) + Familiares (`####-XXX`)
   - DB Local ‚Üí Invitados temporales (`####`) del historial
3. Combina y muestra resultados

**Registro:**
```sql
INSERT INTO entrada_club (codigo_participante, tipo, nombre, dni, area, fecha_hora)
VALUES 
  ('0001', 'socio', 'Juan P√©rez', '12345678', 'Piscina', NOW()),      -- Socio
  ('0001-A', 'socio', 'Mar√≠a P√©rez', '87654321', 'Piscina', NOW()),   -- Familiar
  ('0500', 'invitado', 'Pedro G√≥mez', '11111111', 'Cancha', NOW());   -- Temporal
```

### Registro de Evento

**Socio/Familiar:**
```sql
INSERT INTO participantes_evento 
  (evento_id, tipo, codigo_socio, codigo_participante, dni, nombre)
VALUES 
  (1, 'socio', '0001', '0001', '12345678', 'Juan P√©rez'),      -- Socio
  (1, 'socio', '0001-A', '0001-A', '87654321', 'Mar√≠a P√©rez'); -- Familiar usa su propio c√≥digo
```

**Invitado de Evento:**
```sql
INSERT INTO participantes_evento 
  (evento_id, tipo, codigo_socio, codigo_participante, dni, nombre)
VALUES 
  (1, 'invitado', '0001', '0001-INV1', '99999999', 'Invitado 1'),
  (1, 'invitado', '0001', '0001-INV2', '88888888', 'Invitado 2');
```

---

## Validaciones en C√≥digo

### JavaScript/Frontend

```javascript
// Validar c√≥digo de socio titular
function esSocioTitular(codigo) {
    return /^\d{4}$/.test(codigo);
}

// Validar c√≥digo de familiar
function esFamiliar(codigo) {
    return /^\d{4}-[A-Z]+$/.test(codigo);
}

// Validar c√≥digo de invitado de evento
function esInvitadoEvento(codigo) {
    return /^\d{4}-INV\d+$/.test(codigo);
}

// Extraer c√≥digo del socio titular
function extraerCodigoSocio(codigo) {
    if (esFamiliar(codigo) || esInvitadoEvento(codigo)) {
        return codigo.substring(0, 4);
    }
    return codigo;
}

// Ejemplos
console.log(esSocioTitular('0001'));        // true
console.log(esFamiliar('0001-A'));          // true
console.log(esInvitadoEvento('0001-INV1')); // true
console.log(extraerCodigoSocio('0001-A'));  // '0001'
```

### PHP/Laravel

```php
// En SocioAPIService.php
public function esSocioTitular($codigo) {
    return preg_match('/^\d{4}$/', $codigo) === 1;
}

public function esFamiliar($codigo) {
    return preg_match('/^\d{4}-[A-Z]+$/', $codigo) === 1;
}

public function esInvitadoEvento($codigo) {
    return preg_match('/^\d{4}-INV\d+$/', $codigo) === 1;
}

public function extraerCodigoSocio($codigo) {
    if ($this->esFamiliar($codigo) || $this->esInvitadoEvento($codigo)) {
        return substr($codigo, 0, 4);
    }
    return $codigo;
}
```

---

## Casos de Uso Pr√°cticos

### Caso 1: Familia en Evento
```
Socio titular:     0001 (Juan P√©rez)
Familiar 1:        0001-A (Mar√≠a P√©rez - esposa)
Familiar 2:        0001-B (Pedro P√©rez - hijo)
Invitado evento:   0001-INV1 (Amigo de Juan)
```

### Caso 2: Entrada al Club
```
‚úÖ 0001       ‚Üí Socio de API
‚úÖ 0001-A     ‚Üí Familiar de API
‚úÖ 0500       ‚Üí Invitado temporal (NO en API, del historial)
‚ùå 0001-INV1  ‚Üí NO permitido (solo para eventos)
```

### Caso 3: B√∫squeda en Sistema
```
Input: "0001"
Resultados:
- API: Juan P√©rez (0001) - Socio
- API: Mar√≠a P√©rez (0001-A) - Familiar
- API: Pedro P√©rez (0001-B) - Familiar
- DB Local (participantes_evento): 0001-INV1, 0001-INV2 (solo si est√°n en eventos)
```

---

## Preguntas Frecuentes

**P: ¬øPor qu√© socios e invitados temporales tienen el mismo formato?**  
R: Aunque ambos usan `####`, se diferencian por:
- **Fuente:** Socios est√°n en API, invitados temporales NO
- **Campo tipo:** `'socio'` vs `'invitado'` en tabla `entrada_club`
- **Permanencia:** Socios son permanentes, invitados son temporales

**P: ¬øUn familiar puede tener invitados de evento?**  
R: S√≠, si el familiar act√∫a como anfitri√≥n, sus invitados usar√≠an su c√≥digo:
- Familiar: `0001-A`
- Invitado: `0001-A-INV1` (pero esto debe validarse con el negocio)

**P: ¬øQu√© pasa si un c√≥digo `0500` existe como socio en API y como invitado temporal en DB?**  
R: El de API tiene prioridad. El sistema primero busca en API, y solo si no encuentra, usa el historial local.

**P: ¬øLos invitados temporales pueden participar en eventos?**  
R: No directamente. Si necesitan participar en un evento, deben ser registrados como invitados del socio anfitri√≥n con formato `####-INV#`.
